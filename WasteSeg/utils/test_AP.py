import numpy as np
import matplotlib.pyplot as plt
from sklearn.metrics import precision_recall_curve, average_precision_score

precision_list = [0.9427407803682659, 0.9323710981653752, 0.9509272189925597, 0.9243435177539209, 0.8677914927626306, 0.8991097922848553, 0.9149742138651777, 0.9082146632672041, 0.907082833133246, 0.9352919688983932, 0.9491222537580104, 0.9482359323165496, 0.8492451626621289, 0.9419518040207665, 0.8330064126744594, 0.9652140854440862, 0.9481068648266083, 0.9406277933956019, 0.9686171289734568, 0.9643734643734446, 0.9487001733102213, 0.9120543415756149, 0.0, 0.8942006969886489, 0.8565051198348236, 0.4960297766749366, 0.7328558705655309, 0.9343298546233381, 0.9708386742354836, 0.830907286411377, 0.8079062024016125, 0.8181591488418463, 0.9264133669031763, 0.9708150462446354, 0.9634445921885895, 0.8833432954771824, 0.8826732352369165, 0.7036326834984516, 0.9638592170451589, 0.9251411838527485, 0.5079385610347606, 0.9419069257286081, 0.7566543768765259, 0.8952735947517492, 0.864207317073168, 0.8916139477708125, 0.9213177149981924, 0.8016729920223052, 0.9635231834312628, 0.961096010762429, 0.883170514524641, 0.5062192004638041, 0.9456112616681688, 0.9851063077086337, 0.9824038004750575, 0.6634865568083117, 0.9555366639647289, 0.8880137551342941, 0.8591075996564053, 0.9622305955725902, 0.9616997415768679, 0.9569067023757291, 0.8561003386579542, 0.9693421633554067, 0.6592262254039035, 0.9378236582508431, 0.9394274251130513, 0.9746628795922688, 0.9646570489852747, 0.9740754506597273, 0.9744417622208796, 0.950044422906062, 0.8938205471589803, 0.9555984555984536, 0.9920713089727149, 0.6047142614888824, 0.6256971256971122, 0.2187807968464014, 0.9814372225915992, 0.9957358258852413, 0.9064708235189527, 0.9922885184608117, 0.9631438721136754, 0.9688377355328021, 0.9711537128678547, 0.9696864691043149, 0.9186879823594255, 0.963475647135595, 0.9701213255266474, 0.9561825894099484, 0.9631136166522107, 0.9205495244499864, 0.9565151971110407, 0.9529134887775106, 0.9646497708781355, 0.983944014698481, 0.9731502176214548, 0.9718474064447059, 0.966204329549451, 0.7112657051185921, 0.9669274516111406, 0.922133847317441, 0.945949679452966, 0.9428245175058181, 0.900960886727001, 0.5597351976736957, 0.9767590106643061, 0.9901320670722641, 0.9402331068495078, 0.969076378167285, 0.9741974520709168, 0.9717154107427319, 0.9584984087809303, 0.9452378529348565, 0.981267033140794, 0.9393713504783087, 0.7762997562956867, 0.9502227880330878, 0.6514948683623324, 0.9879172299053749, 0.974031911489046, 0.9514712429675781, 0.9057081584230678, 0.9779581486578734, 0.9651694980994473, 0.9428389290267734, 0.9295094280978023, 0.9585959983554869, 0.913553742664948, 0.03474830954169732, 0.9264523310073166, 0.9268313604391814, 0.9691409897292227, 0.9794779776534613, 0.0, 0.9295698064928805, 0.5405349794238676, 0.9513698779345444, 0.9664289316331607, 0.9811355522284914, 0.9661091932835065, 0.9733118520593935, 0.5156798959011027, 0.9731799925378043, 0.984176479058896, 0.9766066261651299, 0.9740417680114055, 0.9800253749308685, 0.9602269932615213, 0.9431170355466091, 0.9649493615147491, 0.932133687279688, 0.0, 0.9774250759010416, 0.9768573639718999, 0.8888691768241768, 0.9780152238664793, 0.9601083813383718, 0.9996622762580142, 0.8946948544076229, 0.9180546770679533, 0.9353385643708156, 0.9704883475816727, 0.9512447158290234, 0.9045945267386278, 0.9737929069932919, 0.6972990082295769, 0.9754669358909593, 0.9467046066292322, 0.9592682084915264, 0.8895787883872984, 0.9352606419303395, 0.7688802269926319, 0.9843624147889103, 0.9827963519470582, 0.9847529083589555, 0.8745329172926531, 0.9675787988082133, 0.9652115513767597, 0.9456354185337857, 0.9012870794895824, 0.8755066589461449, 0.7282382451833251, 0.9755510056606016, 0.9420471127788176, 0.9880297965986198, 0.9628968253968238, 0.9380971497390531, 0.9352985261054132, 0.9635980497479508, 0.8582727747219623, 0.9123019571295349, 0.9106541393369917, 0.9645712093112427, 0.9242582468210522, 0.966938741858352, 0.9863531088544433, 0.8844903314129231, 0.9773323558916563, 0.9762697915033685, 0.9613291652194013, 0.9558497235906851, 0.9880927167902083, 0.9557385486361243, 0.9581969566465637, 0.8189573832363548, 0.94467029839824, 0.9467125563731293, 0.9383025767497197, 0.9608464576527332, 0.9324507082354584, 0.9795901226272385, 0.9512800993629515, 0.927757320708397, 0.967145922059621, 0.9814619544882446, 0.957813448438656, 0.9780540112853165, 0.9458205031918874, 0.8755602916053502, 0.7943006411778656, 0.9525783818262084, 0.9303259731723326, 0.9579603857481059, 0.7081889365119541, 0.9533634034970473, 0.9294562687063506, 0.9367106371035612, 0.9772475710244718, 0.9493312174110151, 0.9748060708263037, 0.9474167021590245, 0.9651112504594882, 0.94805993573769, 0.9407211887310307, 0.9149071239738409, 0.9570053276007086, 0.9152122866027739, 0.7000535905680564, 0.9823112654248569, 0.9457761188918931, 0.8926242835323278, 0.8831888770820252, 0.9669862081082263, 0.9642486904533358, 0.9681994338015002, 0.9502735833548588, 0.3177550285072374, 0.9738955073383838, 0.9622482855021175, 0.7465545000126433, 0.9694705608980054, 0.9715279480948006, 0.9771249999999991, 0.9595034910783528, 0.9914073524442996, 0.9646196727207295, 0.966005919813432, 0.9453185608999213, 0.6460788616874222, 0.9713156367856072, 0.9611606258665063, 0.9447419735794101, 0.924393197493811, 0.9478334156761284, 0.9591174300851715, 0.7542365041587116, 0.943185904350936, 0.956169045295063, 0.967260756983085, 0.9733296368172969, 0.9886127545064198, 0.9856934364544334]
recall_list = [0.9757966561874803, 0.9577022006287493, 0.9796246110609222, 0.9862900241422436, 0.8603500493027172, 0.9068462401795622, 0.8096603529744324, 0.9017101932456572, 0.6160117397684624, 0.902785473228223, 0.9095854530801345, 0.9800107816711568, 0.9473638814016152, 0.9721745104774958, 0.7586052902782523, 0.84030449712465, 0.9775617053103945, 0.7111320052496516, 0.9178818112048941, 0.9036838066001361, 0.9358864763207346, 0.8789789061688169, 0.0, 0.9375995502670261, 0.9587432461975672, 0.3761446790717115, 0.8113804437140477, 0.9132293986636931, 0.944632516703782, 0.8950111358574571, 0.7431010328087814, 0.9620760433975143, 0.9154133212710568, 0.9901871522508826, 0.9567173197860462, 0.8916486500075375, 0.9347199341021353, 0.9067819879187198, 0.9757914878812449, 0.8288235955477254, 0.7660197015507637, 0.9188352630975547, 0.958469633074527, 0.913497231181157, 0.8624718554128861, 0.9048256556928105, 0.9379676643506115, 0.4084673791220063, 0.9797391227188013, 0.9890516620283372, 0.9667876870046747, 0.6211440212119242, 0.8997564644366418, 0.9845838342408582, 0.8560854446100333, 0.774879716383875, 0.9791039938416026, 0.8441415859074467, 0.997348090515587, 0.9842916715123515, 0.9830456380521997, 0.9775002653270587, 0.8072314691835973, 0.9887950136009062, 0.8930755614910905, 0.974248170032629, 0.9746714877855173, 0.9945959855892935, 0.9663163312295135, 0.9938646152179199, 0.8747460519543829, 0.9792698663780504, 0.8784156430182984, 0.9823890699423393, 0.9942256440627751, 0.9030134211192479, 0.7386680172195306, 0.7870346923271515, 0.9952439091058166, 0.996574407065142, 0.9810254437015993, 0.11723617489255564, 0.9993089149965431, 0.998646625201565, 0.9952411392854592, 0.9938063782939115, 0.9362240012257237, 0.9929283254193054, 0.9826163158001977, 0.9906861331725678, 0.970241059648938, 0.9280387409200879, 0.985963551764246, 0.9936376939367214, 0.9788384892768933, 0.9893160130372869, 0.8706210452924992, 0.9677965779105823, 0.9930530442892198, 0.8030333807299046, 0.9944134078212286, 0.9831824566879962, 0.9845054959417594, 0.9874266445347722, 0.9157480953152825, 0.5199126486983477, 0.9980306513409954, 0.9942446311162416, 0.98716683119447, 0.9951039820945607, 0.9977758158171746, 0.9867077693164634, 0.9909020713734168, 0.9354640167410828, 0.9206876990880124, 0.9689862873253753, 0.9797513776752406, 0.9565551710880308, 0.9355376137382938, 0.9966954460098811, 0.8817564771128182, 0.9853918219353195, 0.8199731488175135, 0.996950983749626, 0.945368892941264, 0.9834399341396988, 0.9259837440330267, 0.9555024331938855, 0.979363252780973, 0.6065573770489815, 0.9601153504880171, 0.9925592504133727, 0.9534723498070894, 0.8214732848561481, 0.0, 0.9778607718448203, 0.9225160090890292, 0.9948063781321178, 0.9625457415512595, 0.997400894466948, 0.9736538110775586, 0.9087044666797404, 0.9310466345588989, 0.9959178172956518, 0.9977876478878771, 0.9739860080288774, 0.9893196750114459, 0.9893159352388031, 0.9632651802510248, 0.9948266713830873, 0.9731337981260247, 0.9511745637017608, 0.0, 0.9765297695022134, 0.9856145356257963, 0.9741522273689015, 0.9143387553040979, 0.9759524140165706, 0.2786826595364071, 0.8806438947781358, 0.9728179922549823, 0.9587429252308537, 0.9790879017013117, 0.9296731546088831, 0.8058599865801744, 0.7645940505479673, 0.7390963990158719, 0.9688643770368466, 0.9019636576787742, 0.8751377735789502, 0.8346717052432556, 0.9114019520851779, 0.6647257049407783, 0.9721209064100556, 0.9782076268095163, 0.9713082719304634, 0.7281649934246396, 0.984208637396814, 0.8452128910844482, 0.9872932105696516, 0.9283113336367722, 0.9462903959945327, 0.673328398716998, 0.9697405046242226, 0.8118024835515217, 0.98371822257263, 0.9344372773659366, 0.9491470349309428, 0.9124289195775718, 0.9573088132671034, 0.8853226207239259, 0.9213176470588148, 0.9204993429697712, 0.9009078963086795, 0.8986978855572758, 0.9520639688273697, 0.9856682511705728, 0.8483886852328039, 0.995089469859164, 0.9785900885859617, 0.9661016949152506, 0.9858045999301828, 0.9670651097445796, 0.9590290927870492, 0.9575371549893789, 0.9134800912120641, 0.984034894554074, 0.9583708776356086, 0.9786677310626177, 0.8739577789604361, 0.6468496938573952, 0.8395479412611515, 0.7964242586877741, 0.9584276786522937, 0.9808398012535285, 0.9370311434416883, 0.9223849576202354, 0.9847382654451667, 0.9456358503033565, 0.7773773052201586, 0.44089423178319037, 0.9842835052853025, 0.9687191056807498, 0.8410352607163658, 0.8681526822116867, 0.9913433700057889, 0.9710046323103634, 0.9920856091851485, 0.9733450928511906, 0.9775884206840172, 0.9638510021009072, 0.9643512188615035, 0.9790624725805025, 0.990889443059018, 0.9914768633970618, 0.8966149073616383, 0.9956436336762655, 0.9847719202403648, 0.602370192751081, 0.9997015602430481, 0.9716793611145297, 0.9560590335801844, 0.934933456211204, 0.9974514789916913, 0.9956052171056725, 0.9974911226518206, 0.9921419114401988, 0.34345933562428327, 0.9880275820262144, 0.9664275686584178, 0.8565377176015465, 0.9809375678217429, 0.9966149764420634, 0.9972753036806172, 0.6002038208317821, 0.9987852737806012, 0.9884374424175374, 0.9922609176340474, 0.9728303581452777, 0.9426957377864009, 0.9688562540693013, 0.9861212712346562, 0.9675958482180501, 0.9877078000618801, 0.9173862901184188, 0.9909506651884694, 0.9149281291125543, 0.8694066953927598, 0.99297298778149, 0.9619609884389883, 0.8500726392251795, 0.9989004068494647, 0.9924527924667863]
IoU_list = [0.921199959529188, 0.8954954654017655, 0.9324840764331181, 0.9126174015131735, 0.760648234634783, 0.8230899830220619, 0.7530048076923049, 0.8264018559384325, 0.5794478527607333, 0.8497131749869585, 0.8672974400845259, 0.9302439823153739, 0.8109794366301163, 0.9172230504958809, 0.6584667680472294, 0.8156045456370686, 0.9279134199134182, 0.6805830247926131, 0.8913732066331118, 0.8744894170070391, 0.8908055329536173, 0.8103007854907696, 0.0, 0.8439740237834167, 0.8260588773478261, 0.27214146334084577, 0.6261771140492703, 0.8581474195303636, 0.9185688915840045, 0.7571121745355863, 0.6315206556650774, 0.7925971655572235, 0.8533628505165463, 0.9615639659110421, 0.9232048374905497, 0.7977149026134641, 0.8314201978263474, 0.6561692827339527, 0.9413492196677268, 0.7767319343225906, 0.4397167091229734, 0.8695573557066366, 0.7326344171053717, 0.825306503930945, 0.7595391211146817, 0.8151640580027937, 0.8684047751592724, 0.3709794195023689, 0.9446995408265109, 0.9509786609798822, 0.8571643286573135, 0.3867931176819995, 0.8554840467191036, 0.9701424938159757, 0.8431567616935207, 0.5562624977276758, 0.9364398159360611, 0.762925439054596, 0.8571495842005624, 0.9476778130573521, 0.9460090331348168, 0.9362843653285733, 0.7107879119648647, 0.9588100686498838, 0.6110019361435208, 0.9151382606822722, 0.9170400610707277, 0.9695285372905734, 0.9332749058183328, 0.9682531304841187, 0.8551265755746201, 0.9313143309580328, 0.7954145621701364, 0.9395041256268336, 0.9863878959996059, 0.5678343949044495, 0.5122936424306197, 0.20655280122283373, 0.9768556608835611, 0.9923393356980146, 0.8908519141315959, 0.11712945936005874, 0.9625027734634999, 0.9675673413589619, 0.9666648269772049, 0.9638615634730361, 0.864581245357323, 0.9569094194359318, 0.9537524231514797, 0.9476635826459051, 0.9354792512594132, 0.8592180774748847, 0.9436651079937619, 0.9471345029239757, 0.9449432026383204, 0.9735985826607522, 0.8501984764204863, 0.9414040804235921, 0.9597174704778704, 0.605611867133044, 0.9617033093073509, 0.9078146204378674, 0.932073253727649, 0.9316397940623358, 0.8319955817378468, 0.36900925888159086, 0.9748800514973908, 0.9844894044742794, 0.9288793858880421, 0.9644777873186582, 0.9720864451777775, 0.9591597561156507, 0.950136809914694, 0.8873720861109922, 0.9047847751695975, 0.9119527198166577, 0.7640415750549594, 0.9109104222601793, 0.6235052955244225, 0.9846919210239923, 0.8615042458552331, 0.9382371136077888, 0.7554807033569293, 0.9750418669980001, 0.9141807494489329, 0.9281039892424913, 0.8652248863814439, 0.9176314322259012, 0.896299936811064, 0.03398236590742039, 0.892118064143784, 0.9204361529942905, 0.9253777916462333, 0.8075737232085126, 0.0, 0.9104094226733048, 0.5170601243472919, 0.9466679191022921, 0.9314031798930713, 0.9786334604604133, 0.9414965542019135, 0.8866130678917759, 0.4967099078774175, 0.9693134184797157, 0.9820335123902995, 0.9517803999916745, 0.963905920922945, 0.9697616773792013, 0.9263066119427766, 0.9385141617653154, 0.9399099292301073, 0.8895695329858568, 0.0, 0.9549906750664479, 0.9631254585473207, 0.8683883202153247, 0.8959244661960203, 0.9379198362916489, 0.2786564241602646, 0.7979366773389969, 0.8950938741948685, 0.899147925687939, 0.950780174391912, 0.8873893611427531, 0.7427334570191636, 0.7491781722550871, 0.5595631191262335, 0.945817630071945, 0.858378076842613, 0.8437832093517407, 0.7563133114566878, 0.8573157499373973, 0.5540250299450651, 0.9573366450133722, 0.9617394511957692, 0.956917263897159, 0.6592902363942611, 0.9527872143298296, 0.8202260015979888, 0.9342648178646674, 0.8426380209678209, 0.8340604784113093, 0.5381157076941268, 0.9467317301230138, 0.7731890412130787, 0.9721323802534894, 0.9019607843137241, 0.8932038834951388, 0.8582562848628345, 0.9238966801362772, 0.7724020812256079, 0.8463600207504682, 0.8442533143420575, 0.8720513413505964, 0.8370514603616088, 0.9220488226738437, 0.9724071309387881, 0.7637671165402404, 0.9726414007602792, 0.955853574306433, 0.9299607989546353, 0.9428719813035541, 0.955924871940806, 0.9182462502060277, 0.9191407325805514, 0.7600058374986292, 0.9304104104104067, 0.909318894271871, 0.9194966456935668, 0.8439039013318452, 0.6178953822932866, 0.8251149628581477, 0.7652120665205596, 0.8918668352296651, 0.9492127345296806, 0.9207352096496237, 0.8863749843964521, 0.9634499025740929, 0.8970439489992151, 0.7000338089120283, 0.39571256181529896, 0.9383065100768427, 0.9031930230909198, 0.8110988876665424, 0.6394173930862713, 0.9454921993649027, 0.9043561499777528, 0.9297628582372779, 0.9517763457346119, 0.9291102729088059, 0.9404242858072462, 0.9153583185616583, 0.9455949493130504, 0.9398673296679027, 0.9331747720681803, 0.8276000409052643, 0.9530147620022693, 0.9024405506883548, 0.4787963200527784, 0.9820232888117535, 0.9204045587843226, 0.8574471106062743, 0.83204679773248, 0.9646029816086661, 0.9601618867120717, 0.9658473990721543, 0.9431747992588007, 0.19768193146006646, 0.9625364485291369, 0.931123392474083, 0.6635797612893071, 0.9515438596491195, 0.9683326296139892, 0.9745233706444394, 0.5853750887433926, 0.9902133995037216, 0.953856412536115, 0.958782159707999, 0.9210029052601733, 0.6216638721145721, 0.9419066708865178, 0.9483321282707659, 0.9157681761307644, 0.9138797074668794, 0.8732929898784317, 0.9507898095947234, 0.7048080096820326, 0.8261417322834516, 0.9497425550591521, 0.9316273331476089, 0.8307226349912431, 0.9875380479898792, 0.9783598415420082]

def compute_ap(recall = 0.1, precision= 0.2):
    mrec = np.concatenate(([0.0], recall, [1.0]))
    mpre = np.concatenate(([0.0], precision, [0.0]))
    for i in range(mpre.size - 1, 0, -1):
        mpre[i - 1] = np.maximum(mpre[i - 1], mpre[i])
    i = np.where(mrec[:-1] != mrec[1:])[0]
    ap = np.sum((mrec[i + 1] - mrec[i]) * mpre[i + 1])
    return ap


def compute_AP50(precision_list, recall_list, IoU_list):
    precision = []
    recall = []
    IoU = []
    for i in range(0, len(IoU_list)):
        if IoU_list[i] >= 0.5:
            precision.append(precision_list[i])
            recall.append(recall_list[i])
            IoU.append(IoU_list[i])

    # 将列表转化为Numpy类型
    precision = np.array(precision_list)
    recall = np.array(recall_list)
    IoU = np.array(IoU_list)

    # 按预测分数从高到低排序
    idxs = np.argsort(recall)
    precision = precision[idxs]
    recall = recall[idxs]
    IoU = IoU[idxs]

    # Compute the area under the Precision-Recall curve
    AP50 = np.trapz(precision, recall)
    return AP50


ap = compute_ap(recall_list, precision_list)
print(ap)

AP = compute_AP50(precision_list, recall_list, IoU_list)
print(AP)
